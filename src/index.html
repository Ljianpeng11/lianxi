<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <title>高青县城市排水防汛应急指挥系统</title>
    <link rel="stylesheet" href="./css/login.css">

    <script type="text/javascript">
        function login() {
            $('#loginPanel').hide();
            $('#loadingMask').show();
            $('#app').show();
            var timmer = setInterval(function () {
                if (!!window.eventHelper) {
                    window.eventHelper.emit('login-start');
                    clearInterval(timmer);
                }
            }, 10);
        };
    </script>
    <link rel="stylesheet" href="../3rd/element-ui/lib/theme-default/index.css">
    <link rel="stylesheet" href="../vendors/loaders.css">

    <!-- Bootstrap -->
    <link href="../3rd/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">


    <!-- Animate.css -->
    <link href="../vendors/animate.css/animate.min.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link rel="stylesheet" href="../lib/arcgis/4.4/esri/css/main.css">
</head>

<body class="nav-md">
<div class="bg-login" id="loginPanel">
    <div class="loginPanel">
        <p class="logo"><img src="./img/login/logo.png"><span class="sysTitle">高青县城市排水防汛应急指挥系统</span></p>
        <div class="srk-login">
            <p class="title-l">用户登录</p>
            <ul>
                <li class="srk">
                    <input class="user" id='userName' type="text" value="eadmin" placeholder="用户名">
                    <input class="password" id='password' type="password" value="123456" placeholder="密码">
                </li>
                <li class="jj-t">
                    <input class="mui-switch mui-switch-anim" type="checkbox">
                    <span>记住用户名</span>
                </li>
                <li class="btn-login"><a onclick="login();">登录</a></li>
                <li>
                    <a class="forget" href="#">忘记密码？</a>
                    <a class="reg" href="#">注册</a>
                </li>
            </ul>
        </div>
    </div>
</div>
<div id="app">
    <div class="loader loaded" id="loadingMask">
        <div class="loader-inner ball-pulse-rise">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    <div class="container body" v-show="isLoginSuccess">
        <!-- top navigation -->
        <app-navigator></app-navigator>
        <!-- /top navigation -->
        <div class="mainContentBox">
            <div class="col-md-3 left_col" :class="{minMenu:isMenuToggleOff}">
                <div class="scroll-view">
                    <!--<div class="navbar nav_title titleBackground"></div>-->
                    <!--<div class="clearfix"></div>-->
                    <!-- menu profile quick info
                    <app-profile></app-profile>
                    /menu profile quick info -->

                    <!-- sidebar menu -->
                    <app-menu></app-menu>

                    <!-- /menu footer buttons -->
                    <!--<app-footer></app-footer>-->
                    <!-- /menu footer buttons -->
                </div>
            </div>
            <div class="rightContainer" :class="{maxContainer:isMenuToggleOff}">
                <app-tab></app-tab>
                <!-- page content -->
                <div class="right_col pageContent" role="main" :class="{maxContainer:isMenuToggleOff}">
                    <!--  <router-view></router-view>-->
                    <main-view></main-view>
                    <!-- /sidebar menu -->
                    <!--<app-search></app-search>-->
                </div>
            </div>
        </div>
        <!-- /page content -->

        <!-- footer content -->
        <!--           <footer>
                       <div class="pull-right">
                           <a href="https://www.baidu.com">中工水务</a>版权所有
                       </div>
                       <div class="clearfix"></div>
                   </footer>-->
        <!-- /footer content -->
    </div>
    <app-login></app-login>
</div>
<!-- jQuery -->
<script src="../vendors/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap -->
<script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="../3rd/vue/dist/vue.min.js"></script>
<script src="../lib/arcgis/4.4/init.js"></script>

<script type="text/javascript">
    window.cesc = {
        require: require,
        define: define,
        dojo: dojo
    }
    var agent = navigator.userAgent.toLowerCase();
    var regStr_ie = /msie [\d.]+/gi;
    var regStr_ff = /firefox\/[\d.]+/gi
    var regStr_chrome = /chrome\/[\d.]+/gi;
    var regStr_saf = /safari\/[\d.]+/gi;
    var isIE = false;
    //IE
    if (agent.indexOf("msie") > 0) {
        isIE = true;
    }
    //firefox
    if (agent.indexOf("firefox") > 0) {
    }
    //Chrome
    if (agent.indexOf("chrome") > 0) {
    }
    //Safari
    if (agent.indexOf("safari") > 0) {
    }
    if (isIE11()) {
        isIE = true;
    }
    //IE11
    function isIE11() { //IE
        if (!!window.ActiveXObject || "ActiveXObject" in window)
            return true;
        else
            return false;
    }
    if (isIE) {
        var link = document.createElement('link');
        link.type = 'text/css';
        link.rel = 'stylesheet';
        link.href = './css/ieFix.css';
        document.getElementsByTagName("head")[0].appendChild(link);
    }
</script>


<script src="../vendors/gridly/javascripts/jquery.gridly.js" async="async"></script>

<!--webpack dll文件-->
<script src="../build/dist/vendor.dll.js"></script>
<script type="text/javascript" src="../release/app.bundle.js"></script>
<!-- Custom Theme Scripts -->
<script src="../vendors/custom.js"></script>
<script src="../vendors/skycons/skycons.js"></script>

<script src="../vendors/skycons/skycons.js"></script>
<!-- ocx 事件处理 -->
<script language="javascript" for="eLTE_PlayerOCX" event="ELTE_OCX_Event(ulEventType,pEventDataXml)">
    var msg = "EventType: ";
    var isLogin = false;
    msg +=    ulEventType;
    console.log(pEventDataXml);
    if (ulEventType == 2){
        var xmlDoc = $.parseXML(pEventDataXml);
        xmlDoc = $(xmlDoc);
        var type = xmlDoc.find("StatusType").text();
        var value = xmlDoc.find("StatusValue").text();
        var strResId = xmlDoc.find("ResourceID").text();

        if (type == 15 && value == 4011){
            if(isLogin == false){
                alert("login success");
                isLogin = true;
            }
        } else if (type == 15 && value != 4011 && value != 4017) {
            if(isLogin == true)
            {
                alert("login failed");
            }
        } else if (type == 11) {
            var strOut;
            if(value == 4003) {
                strOut = "group[";
                strOut += strResId;
                strOut += "]subscribe success.";
            } else if(value == 4004) {
                strOut = "group[";
                strOut += strResId;
                strOut += "]unsubscribe success.";
            }
            alert(strOut);
        } else if (type == 21) {
            var cause = xmlDoc.find("Cause").text();
            var group = xmlDoc.find("AttachingGroup").text();
            var strOut;
            if(value == 4025) {
                strOut = "dynamic group[";
                strOut += group;
                strOut += "]create failed.failture =";
                strOut += cause;
            } else if(value == 4024) {
                strOut = "dynamic group[";
                strOut += group;
                strOut += "]craete success.";
                $("#DgroupId").val(group);
            }
            alert(strOut);
        }

        msg += " type:"
        msg += type;
        msg += " value:"
        msg += value;
    } else if (ulEventType == 1) {
        var xmlDoc = $.parseXML(pEventDataXml);
        xmlDoc = $(xmlDoc);
        var type = xmlDoc.find("CallStatus").text();
        if (type == 3003) {
            var localVideoPort = xmlDoc.find("LocalVideoPort").text();
            var localAudioPort = xmlDoc.find("LocalAudioPort").text();
            var remoteVideoPort = xmlDoc.find("RemoteVideoPort").text();
            var remoteAudioPort = xmlDoc.find("RemoteAudioPort").text();

            $("#localVideoPort").val(localVideoPort);
            $("#localAudioPort").val(localAudioPort);
            $("#remoteVideoPort").val(remoteVideoPort);
            $("#remoteAudioPort").val(remoteAudioPort);
            //为了与界面按钮状态保持一致这里需要静音
            var param = "<Content><MuteParam><CallType>2</CallType></MuteParam></Content>";

            resultXml = eLTE_PlayerOCX.ELTE_OCX_VolMute(xmlDoc.find("Callee").text(), param);
        } else if (type == 3009) {
            $("#localVideoPort").val("");
            $("#localAudioPort").val("");
            $("#remoteVideoPort").val("");
            $("#remoteAudioPort").val("");
        } else if (type == 3011) {
            var strResID = xmlDoc.find("Uri").text();
            var strMuteType = xmlDoc.find("SoundMute").text();
            $("#resourceId").val(strResID);
            $("#muteType").val(strMuteType);
            if(confirm(strResID + " Video call prompt")) {
                RecvVideoPlay();
            } else {
                StopRealPlay();
            }
        } else if (type == 3006) {
            //In order to keep in line with the button state of the interface, there is a need for silence.
            var param = "<Content><MuteParam><CallType>2</CallType></MuteParam></Content>";

            resultXml = eLTE_PlayerOCX.ELTE_OCX_VolMute(xmlDoc.find("Callee").text(), param);
        }
        if (3021 == type || 3013 == type || 3008 == type) {
            //alert(type);
            var strResID = xmlDoc.find("Uri").text();
            if(3008 == type) {
                strResID = xmlDoc.find("Uri").text();
            }
            StopCurrentRealPlay(strResID);
        }

        msg += " type:"
        msg += type;
    } else if (ulEventType == 4) {
        <!-- GetDcUsers();	TriggerStatusReport();	-->
    } else if (ulEventType == 5) {
        var xmlDoc = $.parseXML(pEventDataXml);
        xmlDoc = $(xmlDoc);
        var status = xmlDoc.find("P2pcallStatus").text();
        var caller = xmlDoc.find("Caller").text();
        var callee = xmlDoc.find("Callee").text();

        if (status == 2002) {
            $("#p2pResId").val(caller);
            alert("Call request:" + caller);
        } else if (status == 2003) {
            alert("P2P accepted");
        } else if (status == 2009 || status == 2010) {
            alert("P2P hangup");
        } else if (status == 2011) {
            alert("P2P canceled");
        } else if (status == 2013) {
            alert("P2P busy");
        } else if (status == 2017) {
            alert("P2P no answer");
        } else if (status == 2020) {
            alert("P2P failed");
        }
    } else if (ulEventType == 6) {
        var xmlDoc = $.parseXML(pEventDataXml);
        xmlDoc = $(xmlDoc);
        var grpId = xmlDoc.find("GroupID").text();
        var status = xmlDoc.find("GroupCallStatus").text();
        var speaker = xmlDoc.find("Speaker").text();

        $("#groupId").val(grpId);
        $("#speakerId").val(speaker);
    } else if (ulEventType ==0 || ulEventType == 8 || ulEventType == 9 || ulEventType == 10 || ulEventType == 11) {
        msg += pEventDataXml;
    } else if (ulEventType ==7) {
        //alert(pEventDataXml);
    }
    $("#eventType").val(msg);
</script>

<!-- ocx 加载 -->
<div class="ocxDiv">
    <OBJECT id="eLTE_PlayerOCX" classid="CLSID:6AB35B6F-D5D4-4DA3-9503-1AD4E5E1E589"/>
</div>
</body>
</html>